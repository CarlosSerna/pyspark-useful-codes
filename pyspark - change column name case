import re

def to_pascal_case(name: str, exceptions=None, preserve_acronym_case=True) -> str:
    """
    Convert a column name to PascalCase.

    This function handles various formats such as snake_case, kebab-case, 
    camelCase, PascalCase, and names with dots or spaces.

    Parameters:
    ----------
    name : str
        The original column name.
    exceptions : list of str, optional
        List of acronyms or terms (e.g., ['ID', 'SKU']) that should be treated specially.
    preserve_acronym_case : bool, default=True
        If True, exceptions will remain uppercase (e.g., 'SKU'), 
        otherwise they will be capitalized like 'Sku'.

    Returns:
    -------
    str
        The column name converted to PascalCase.
    """
    if exceptions is None:
        exceptions = []

    name = re.sub(r"[.\-_\s]+", " ", name)
    words = re.split(r"\s+", name.strip())

    result = []
    for word in words:
        if not word:
            continue
        if word.upper() in exceptions:
            result.append(word.upper() if preserve_acronym_case else word.capitalize())
        else:
            result.append(word.capitalize())

    return ''.join(result)

def to_snake_case(name: str, exceptions=None, preserve_acronym_case=True) -> str:
    """
    Convert a column name to snake_case.

    This function handles various formats such as camelCase, PascalCase, kebab-case, 
    names with dots, spaces, or underscores. It ensures consistent casing and delimiter.

    Parameters:
    ----------
    name : str
        The original column name.
    exceptions : list of str, optional
        List of acronyms or terms (e.g., ['ID', 'SKU']) that should be treated specially.
    preserve_acronym_case : bool, default=True
        If True, exceptions will remain uppercase (e.g., 'SKU'),
        otherwise they will be converted to lowercase ('sku').

    Returns:
    -------
    str
        The column name converted to snake_case.
    """
    if exceptions is None:
        exceptions = []

    name = re.sub(r"[.\-_\s]+", " ", name)
    name = re.sub(r"([a-z0-9])([A-Z])", r"\1 \2", name)

    words = re.split(r"\s+", name.strip())

    result = []
    for word in words:
        if not word:
            continue
        if word.upper() in exceptions:
            cleaned = word.upper() if preserve_acronym_case else word.lower()
            result.append(cleaned)
        else:
            result.append(word.lower())

    return "_".join(result)

def standardize_column_names_to_pascal_case(df, exceptions=None, preserve_acronym_case=True):
    """
    Apply PascalCase formatting to all column names in a Spark DataFrame.

    Parameters:
    ----------
    df : pyspark.sql.DataFrame
        The input DataFrame.
    exceptions : list of str, optional
        List of acronyms to preserve in full uppercase (e.g., ['ID', 'SKU']).
    preserve_acronym_case : bool, default=True
        Whether to keep acronyms in full uppercase.

    Returns:
    -------
    pyspark.sql.DataFrame
        DataFrame with renamed columns in PascalCase.
    """
    cols = [to_pascal_case(c, exceptions, preserve_acronym_case) for c in df.columns]
    return df.toDF(*cols)


def standardize_column_names_to_snake_case(df, exceptions=None, preserve_acronym_case=True):
    """
    Apply snake_case formatting to all column names in a Spark DataFrame.

    Parameters:
    ----------
    df : pyspark.sql.DataFrame
        The input DataFrame.
    exceptions : list of str, optional
        List of acronyms to preserve in full uppercase or lowercase.
    preserve_acronym_case : bool, default=True
        Whether to preserve acronyms in uppercase ('ID') or convert to lowercase ('id').

    Returns:
    -------
    pyspark.sql.DataFrame
        DataFrame with renamed columns in snake_case.
    """
    cols = [to_snake_case(c, exceptions, preserve_acronym_case) for c in df.columns]
    return df.toDF(*cols)
